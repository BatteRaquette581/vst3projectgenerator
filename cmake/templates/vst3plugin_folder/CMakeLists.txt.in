cmake_minimum_required(VERSION 3.14.0)

include(SMTG_Fetch_VST3_SDK.cmake)
include(${vst3sdk_SOURCE_DIR}/cmake/modules/SMTG_VST3_SDK.cmake)

project(@SMTG_CMAKE_PROJECT_NAME@)
setupPlatformToolset()
setupCoreAudioSupport()
setupAaxSupport()

smtg_add_vst3plugin(@SMTG_PLUGIN_BUNDLE_NAME@
    source/@SMTG_PREFIX_FOR_FILENAMES@cids.h
    source/@SMTG_PREFIX_FOR_FILENAMES@component.h
    source/@SMTG_PREFIX_FOR_FILENAMES@component.cpp
    source/@SMTG_PREFIX_FOR_FILENAMES@controller.h
    source/@SMTG_PREFIX_FOR_FILENAMES@controller.cpp
    source/@SMTG_PREFIX_FOR_FILENAMES@entry.cpp
)

add_subdirectory(${vst3sdk_SOURCE_DIR}/base ${vst3sdk_BINARY_DIR}/base)
add_subdirectory(${vst3sdk_SOURCE_DIR}/pluginterfaces ${vst3sdk_BINARY_DIR}/pluginterfaces)
add_subdirectory(${vst3sdk_SOURCE_DIR}/public.sdk ${vst3sdk_BINARY_DIR}/public.sdk)

target_link_libraries(@SMTG_PLUGIN_BUNDLE_NAME@
    PRIVATE
        sdk
)

if(SMTG_MAC)
    smtg_set_bundle(@SMTG_PLUGIN_BUNDLE_NAME@ INFOPLIST 
        "${CMAKE_CURRENT_LIST_DIR}/resource/Info.plist" 
        PREPROCESS
    )
elseif(SMTG_WIN)
    target_sources(@SMTG_PLUGIN_BUNDLE_NAME@ PRIVATE 
        resource/@SMTG_PREFIX_FOR_FILENAMES@.rc
    )
endif()